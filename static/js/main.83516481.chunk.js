(this.webpackJsonp2048=this.webpackJsonp2048||[]).push([[0],[,,,,,,,,,,,,function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return n}));var s,n=n||{REVISION:"ALPHA"};!function(t){var e=!1,i=0,s=function t(){if(e)return e=!1,i;var s=2*Math.random()-1,n=2*Math.random()-1,r=s*s+n*n;if(0==r||r>1)return t();var a=Math.sqrt(-2*Math.log(r)/r);return i=n*a,e=!0,s*a},n=function(t,e){return Math.random()*(e-t)+t},r=function(t,e){for(var i=0,s=t.length;i<s;i++)if(t[i]===e)return!0;return!1};t.randf=n,t.randi=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.randn=function(t,e){return t+s()*e},t.zeros=function(t){if("undefined"===typeof t||isNaN(t))return[];if("undefined"===typeof ArrayBuffer){for(var e=new Array(t),i=0;i<t;i++)e[i]=0;return e}return new Float64Array(t)},t.maxmin=function(t){if(0===t.length)return{};for(var e=t[0],i=t[0],s=0,n=0,r=t.length,a=1;a<r;a++)t[a]>e&&(e=t[a],s=a),t[a]<i&&(i=t[a],n=a);return{maxi:s,maxv:e,mini:n,minv:i,dv:e-i}},t.randperm=function(t){for(var e,i=t,s=0,n=[],r=0;r<t;r++)n[r]=r;for(;i--;)s=Math.floor(Math.random()*(i+1)),e=n[i],n[i]=n[s],n[s]=e;return n},t.weightedSample=function(t,e){for(var i=n(0,1),s=0,r=0,a=t.length;r<a;r++)if(i<(s+=e[r]))return t[r]},t.arrUnique=function(t){for(var e=[],i=0,s=t.length;i<s;i++)r(e,t[i])||e.push(t[i]);return e},t.arrContains=r,t.getopt=function(t,e,i){if("string"===typeof e)return"undefined"!==typeof t[e]?t[e]:i;for(var s=i,n=0;n<e.length;n++){var r=e[n];"undefined"!==typeof t[r]&&(s=t[r])}return s},t.assert=function(t,e){if(!t){if(e=e||"Assertion failed","undefined"!==typeof Error)throw new Error(e);throw e}}}(n),function(t){var e=function(e,i,s,n){if("[object Array]"===Object.prototype.toString.call(e)){this.sx=1,this.sy=1,this.depth=e.length,this.w=t.zeros(this.depth),this.dw=t.zeros(this.depth);for(var r=0;r<this.depth;r++)this.w[r]=e[r]}else{this.sx=e,this.sy=i,this.depth=s;var a=e*i*s;if(this.w=t.zeros(a),this.dw=t.zeros(a),"undefined"===typeof n){var o=Math.sqrt(1/(e*i*s));for(r=0;r<a;r++)this.w[r]=t.randn(0,o)}else for(r=0;r<a;r++)this.w[r]=n}};e.prototype={get:function(t,e,i){var s=(this.sx*e+t)*this.depth+i;return this.w[s]},set:function(t,e,i,s){var n=(this.sx*e+t)*this.depth+i;this.w[n]=s},add:function(t,e,i,s){var n=(this.sx*e+t)*this.depth+i;this.w[n]+=s},get_grad:function(t,e,i){var s=(this.sx*e+t)*this.depth+i;return this.dw[s]},set_grad:function(t,e,i,s){var n=(this.sx*e+t)*this.depth+i;this.dw[n]=s},add_grad:function(t,e,i,s){var n=(this.sx*e+t)*this.depth+i;this.dw[n]+=s},cloneAndZero:function(){return new e(this.sx,this.sy,this.depth,0)},clone:function(){for(var t=new e(this.sx,this.sy,this.depth,0),i=this.w.length,s=0;s<i;s++)t.w[s]=this.w[s];return t},addFrom:function(t){for(var e=0;e<this.w.length;e++)this.w[e]+=t.w[e]},addFromScaled:function(t,e){for(var i=0;i<this.w.length;i++)this.w[i]+=e*t.w[i]},setConst:function(t){for(var e=0;e<this.w.length;e++)this.w[e]=t},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.depth=this.depth,t.w=this.w,t},fromJSON:function(e){this.sx=e.sx,this.sy=e.sy,this.depth=e.depth;var i=this.sx*this.sy*this.depth;this.w=t.zeros(i),this.dw=t.zeros(i);for(var s=0;s<i;s++)this.w[s]=e.w[s]}},t.Vol=e}(n),function(t){var e=t.Vol;t.augment=function(i,s,n,r,a){if("undefined"===typeof a)a=!1;if("undefined"===typeof n)n=t.randi(0,i.sx-s);if("undefined"===typeof r)r=t.randi(0,i.sy-s);var o;if(s!==i.sx||0!==n||0!==r){o=new e(s,s,i.depth,0);for(var h=0;h<s;h++)for(var u=0;u<s;u++)if(!(h+n<0||h+n>=i.sx||u+r<0||u+r>=i.sy))for(var l=0;l<i.depth;l++)o.set(h,u,l,i.get(h+n,u+r,l))}else o=i;if(a){var d=o.cloneAndZero();for(h=0;h<o.sx;h++)for(u=0;u<o.sy;u++)for(l=0;l<o.depth;l++)d.set(h,u,l,o.get(o.sx-h-1,u,l));o=d}return o},t.img_to_vol=function(t,i){if("undefined"===typeof i)i=!1;var s=document.createElement("canvas");s.width=t.width,s.height=t.height;var n=s.getContext("2d");try{n.drawImage(t,0,0)}catch(_){if("NS_ERROR_NOT_AVAILABLE"===_.name)return!1;throw _}try{var r=n.getImageData(0,0,s.width,s.height)}catch(_){if("IndexSizeError"===_.name)return!1;throw _}for(var a=r.data,o=t.width,h=t.height,u=[],l=0;l<a.length;l++)u.push(a[l]/255-.5);var d=new e(o,h,4,0);if(d.w=u,i){var c=new e(o,h,1,0);for(l=0;l<o;l++)for(var f=0;f<h;f++)c.set(l,f,0,d.get(l,f,0));d=c}return d}}(n),function(t){var e=t.Vol,i=function(t){t=t||{};this.out_depth=t.filters,this.sx=t.sx,this.in_depth=t.in_depth,this.in_sx=t.in_sx,this.in_sy=t.in_sy,this.sy="undefined"!==typeof t.sy?t.sy:this.sx,this.stride="undefined"!==typeof t.stride?t.stride:1,this.pad="undefined"!==typeof t.pad?t.pad:0,this.l1_decay_mul="undefined"!==typeof t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul="undefined"!==typeof t.l2_decay_mul?t.l2_decay_mul:1,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="conv";var i="undefined"!==typeof t.bias_pref?t.bias_pref:0;this.filters=[];for(var s=0;s<this.out_depth;s++)this.filters.push(new e(this.sx,this.sy,this.in_depth));this.biases=new e(1,1,this.out_depth,i)};i.prototype={forward:function(t,i){this.in_act=t;for(var s=new e(0|this.out_sx,0|this.out_sy,0|this.out_depth,0),n=0|t.sx,r=0|t.sy,a=0|this.stride,o=0;o<this.out_depth;o++)for(var h=this.filters[o],u=0|-this.pad,l=0|-this.pad,d=0;d<this.out_sy;l+=a,d++){u=0|-this.pad;for(var c=0;c<this.out_sx;u+=a,c++){for(var f=0,_=0;_<h.sy;_++)for(var p=l+_,y=0;y<h.sx;y++){var v=u+y;if(p>=0&&p<r&&v>=0&&v<n)for(var m=0;m<h.depth;m++)f+=h.w[(h.sx*_+y)*h.depth+m]*t.w[(n*p+v)*t.depth+m]}f+=this.biases.w[o],s.set(c,d,o,f)}}return this.out_act=s,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=0|e.sx,s=0|e.sy,n=0|this.stride,r=0;r<this.out_depth;r++)for(var a=this.filters[r],o=0|-this.pad,h=0|-this.pad,u=0;u<this.out_sy;h+=n,u++){o=0|-this.pad;for(var l=0;l<this.out_sx;o+=n,l++){for(var d=this.out_act.get_grad(l,u,r),c=0;c<a.sy;c++)for(var f=h+c,_=0;_<a.sx;_++){var p=o+_;if(f>=0&&f<s&&p>=0&&p<i)for(var y=0;y<a.depth;y++){var v=(i*f+p)*e.depth+y,m=(a.sx*c+_)*a.depth+y;a.dw[m]+=e.w[v]*d,e.dw[v]+=a.w[m]*d}}this.biases.dw[r]+=d}}},getParamsAndGrads:function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.pad=this.pad,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.sx=t.sx,this.sy=t.sy,this.stride=t.stride,this.in_depth=t.in_depth,this.filters=[],this.l1_decay_mul="undefined"!==typeof t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul="undefined"!==typeof t.l2_decay_mul?t.l2_decay_mul:1,this.pad="undefined"!==typeof t.pad?t.pad:0;for(var i=0;i<t.filters.length;i++){var s=new e(0,0,0,0);s.fromJSON(t.filters[i]),this.filters.push(s)}this.biases=new e(0,0,0,0),this.biases.fromJSON(t.biases)}};var s=function(t){t=t||{};this.out_depth="undefined"!==typeof t.num_neurons?t.num_neurons:t.filters,this.l1_decay_mul="undefined"!==typeof t.l1_decay_mul?t.l1_decay_mul:0,this.l2_decay_mul="undefined"!==typeof t.l2_decay_mul?t.l2_decay_mul:1,this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_sx=1,this.out_sy=1,this.layer_type="fc";var i="undefined"!==typeof t.bias_pref?t.bias_pref:0;this.filters=[];for(var s=0;s<this.out_depth;s++)this.filters.push(new e(1,1,this.num_inputs));this.biases=new e(1,1,this.out_depth,i)};s.prototype={forward:function(t,i){this.in_act=t;for(var s=new e(1,1,this.out_depth,0),n=t.w,r=0;r<this.out_depth;r++){for(var a=0,o=this.filters[r].w,h=0;h<this.num_inputs;h++)a+=n[h]*o[h];a+=this.biases.w[r],s.w[r]=a}return this.out_act=s,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);for(var i=0;i<this.out_depth;i++){for(var s=this.filters[i],n=this.out_act.dw[i],r=0;r<this.num_inputs;r++)e.dw[r]+=s.w[r]*n,s.dw[r]+=e.w[r]*n;this.biases.dw[i]+=n}},getParamsAndGrads:function(){for(var t=[],e=0;e<this.out_depth;e++)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),t},toJSON:function(){var t={};t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t.l1_decay_mul=this.l1_decay_mul,t.l2_decay_mul=this.l2_decay_mul,t.filters=[];for(var e=0;e<this.filters.length;e++)t.filters.push(this.filters[e].toJSON());return t.biases=this.biases.toJSON(),t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs,this.l1_decay_mul="undefined"!==typeof t.l1_decay_mul?t.l1_decay_mul:1,this.l2_decay_mul="undefined"!==typeof t.l2_decay_mul?t.l2_decay_mul:1,this.filters=[];for(var i=0;i<t.filters.length;i++){var s=new e(0,0,0,0);s.fromJSON(t.filters[i]),this.filters.push(s)}this.biases=new e(0,0,0,0),this.biases.fromJSON(t.biases)}},t.ConvLayer=i,t.FullyConnLayer=s}(n),function(t){var e=t.Vol,i=function(e){e=e||{};this.sx=e.sx,this.in_depth=e.in_depth,this.in_sx=e.in_sx,this.in_sy=e.in_sy,this.sy="undefined"!==typeof e.sy?e.sy:this.sx,this.stride="undefined"!==typeof e.stride?e.stride:2,this.pad="undefined"!==typeof e.pad?e.pad:0,this.out_depth=this.in_depth,this.out_sx=Math.floor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=Math.floor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="pool",this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)};i.prototype={forward:function(t,i){this.in_act=t;for(var s=new e(this.out_sx,this.out_sy,this.out_depth,0),n=0,r=0;r<this.out_depth;r++)for(var a=-this.pad,o=-this.pad,h=0;h<this.out_sx;a+=this.stride,h++){o=-this.pad;for(var u=0;u<this.out_sy;o+=this.stride,u++){for(var l=-99999,d=-1,c=-1,f=0;f<this.sx;f++)for(var _=0;_<this.sy;_++){var p=o+_,y=a+f;if(p>=0&&p<t.sy&&y>=0&&y<t.sx){var v=t.get(y,p,r);v>l&&(l=v,d=y,c=p)}}this.switchx[n]=d,this.switchy[n]=c,n++,s.set(h,u,r,l)}}return this.out_act=s,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);this.out_act;for(var i=0,s=0;s<this.out_depth;s++){this.pad,this.pad;for(var n=0;n<this.out_sx;this.stride,n++){-this.pad;for(var r=0;r<this.out_sy;this.stride,r++){var a=this.out_act.get_grad(n,r,s);e.add_grad(this.switchx[i],this.switchy[i],s,a),i++}}}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.sx=this.sx,t.sy=this.sy,t.stride=this.stride,t.in_depth=this.in_depth,t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.pad=this.pad,t},fromJSON:function(e){this.out_depth=e.out_depth,this.out_sx=e.out_sx,this.out_sy=e.out_sy,this.layer_type=e.layer_type,this.sx=e.sx,this.sy=e.sy,this.stride=e.stride,this.in_depth=e.in_depth,this.pad="undefined"!==typeof e.pad?e.pad:0,this.switchx=t.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=t.zeros(this.out_sx*this.out_sy*this.out_depth)}},t.PoolLayer=i}(n),function(t){t.Vol;var e=t.getopt,i=function(t){t=t||{};this.out_depth=e(t,["out_depth","depth"],0),this.out_sx=e(t,["out_sx","sx","width"],1),this.out_sy=e(t,["out_sy","sy","height"],1),this.layer_type="input"};i.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t,this.out_act},backward:function(){},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.InputLayer=i}(n),function(t){var e=t.Vol,i=function(t){t=t||{};this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="softmax"};i.prototype={forward:function(i,s){this.in_act=i;for(var n=new e(1,1,this.out_depth,0),r=i.w,a=i.w[0],o=1;o<this.out_depth;o++)r[o]>a&&(a=r[o]);var h=t.zeros(this.out_depth),u=0;for(o=0;o<this.out_depth;o++){var l=Math.exp(r[o]-a);u+=l,h[o]=l}for(o=0;o<this.out_depth;o++)h[o]/=u,n.w[o]=h[o];return this.es=h,this.out_act=n,this.out_act},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var s=0;s<this.out_depth;s++){var n=-((s===e?1:0)-this.es[s]);i.dw[s]=n}return-Math.log(this.es[e])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}};var s=function(t){t=t||{};this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="regression"};s.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t,t},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);var s=0;if(e instanceof Array||e instanceof Float64Array)for(var n=0;n<this.out_depth;n++){var r=i.w[n]-e[n];i.dw[n]=r,s+=.5*r*r}else if("number"===typeof e){r=i.w[0]-e;i.dw[0]=r,s+=.5*r*r}else{n=e.dim;var a=e.val;r=i.w[n]-a;i.dw[n]=r,s+=.5*r*r}return s},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}};var n=function(t){t=t||{};this.num_inputs=t.in_sx*t.in_sy*t.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="svm"};n.prototype={forward:function(t,e){return this.in_act=t,this.out_act=t,t},backward:function(e){var i=this.in_act;i.dw=t.zeros(i.w.length);for(var s=i.w[e],n=0,r=0;r<this.out_depth;r++)if(e!==r){var a=-s+i.w[r]+1;a>0&&(i.dw[r]+=1,i.dw[e]-=1,n+=a)}return n},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.num_inputs=this.num_inputs,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.num_inputs=t.num_inputs}},t.RegressionLayer=s,t.SoftmaxLayer=i,t.SVMLayer=n}(n),function(t){var e=t.Vol,i=function(t){t=t||{};this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="relu"};i.prototype={forward:function(t,e){this.in_act=t;for(var i=t.clone(),s=t.w.length,n=i.w,r=0;r<s;r++)n[r]<0&&(n[r]=0);return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var n=0;n<s;n++)i.w[n]<=0?e.dw[n]=0:e.dw[n]=i.dw[n]},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}};var s=function(t){t=t||{};this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="sigmoid"};s.prototype={forward:function(t,e){this.in_act=t;for(var i=t.cloneAndZero(),s=t.w.length,n=i.w,r=t.w,a=0;a<s;a++)n[a]=1/(1+Math.exp(-r[a]));return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var n=0;n<s;n++){var r=i.w[n];e.dw[n]=r*(1-r)*i.dw[n]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}};var n=function(e){e=e||{};this.group_size="undefined"!==typeof e.group_size?e.group_size:2,this.out_sx=e.in_sx,this.out_sy=e.in_sy,this.out_depth=Math.floor(e.in_depth/this.group_size),this.layer_type="maxout",this.switches=t.zeros(this.out_sx*this.out_sy*this.out_depth)};function r(t){var e=Math.exp(2*t);return(e-1)/(e+1)}n.prototype={forward:function(t,i){this.in_act=t;var s=this.out_depth,n=new e(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var r=0;r<s;r++){for(var a=r*this.group_size,o=t.w[a],h=0,u=1;u<this.group_size;u++){(f=t.w[a+u])>o&&(o=f,h=u)}n.w[r]=o,this.switches[r]=a+h}else for(var l=0,d=0;d<t.sx;d++)for(var c=0;c<t.sy;c++)for(r=0;r<s;r++){for(a=r*this.group_size,o=t.get(d,c,a),h=0,u=1;u<this.group_size;u++){var f;(f=t.get(d,c,a+u))>o&&(o=f,h=u)}n.set(d,c,r,o),this.switches[l]=a+h,l++}return this.out_act=n,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=this.out_depth;if(e.dw=t.zeros(e.w.length),1===this.out_sx&&1===this.out_sy)for(var n=0;n<s;n++){var r=i.dw[n];e.dw[this.switches[n]]=r}else for(var a=0,o=0;o<i.sx;o++)for(var h=0;h<i.sy;h++)for(n=0;n<s;n++){r=i.get_grad(o,h,n);e.set_grad(o,h,this.switches[a],r),a++}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.group_size=this.group_size,t},fromJSON:function(e){this.out_depth=e.out_depth,this.out_sx=e.out_sx,this.out_sy=e.out_sy,this.layer_type=e.layer_type,this.group_size=e.group_size,this.switches=t.zeros(this.group_size)}};var a=function(t){t=t||{};this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="tanh"};a.prototype={forward:function(t,e){this.in_act=t;for(var i=t.cloneAndZero(),s=t.w.length,n=0;n<s;n++)i.w[n]=r(t.w[n]);return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var n=0;n<s;n++){var r=i.w[n];e.dw[n]=(1-r*r)*i.dw[n]}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type}},t.TanhLayer=a,t.MaxoutLayer=n,t.ReluLayer=i,t.SigmoidLayer=s}(n),function(t){t.Vol;var e=function(e){e=e||{};this.out_sx=e.in_sx,this.out_sy=e.in_sy,this.out_depth=e.in_depth,this.layer_type="dropout",this.drop_prob="undefined"!==typeof e.drop_prob?e.drop_prob:.5,this.dropped=t.zeros(this.out_sx*this.out_sy*this.out_depth)};e.prototype={forward:function(t,e){this.in_act=t,"undefined"===typeof e&&(e=!1);var i=t.clone(),s=t.w.length;if(e)for(var n=0;n<s;n++)Math.random()<this.drop_prob?(i.w[n]=0,this.dropped[n]=!0):this.dropped[n]=!1;else for(n=0;n<s;n++)i.w[n]*=this.drop_prob;return this.out_act=i,this.out_act},backward:function(){var e=this.in_act,i=this.out_act,s=e.w.length;e.dw=t.zeros(s);for(var n=0;n<s;n++)this.dropped[n]||(e.dw[n]=i.dw[n])},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.out_depth=this.out_depth,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.layer_type=this.layer_type,t.drop_prob=this.drop_prob,t},fromJSON:function(t){this.out_depth=t.out_depth,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.layer_type=t.layer_type,this.drop_prob=t.drop_prob}},t.DropoutLayer=e}(n),function(t){t.Vol;var e=function(t){t=t||{};this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.in_sx,this.out_sy=t.in_sy,this.out_depth=t.in_depth,this.layer_type="lrn",this.n%2===0&&console.log("WARNING n should be odd for LRN layer")};e.prototype={forward:function(t,e){this.in_act=t;var i=t.cloneAndZero();this.S_cache_=t.cloneAndZero();for(var s=Math.floor(this.n/2),n=0;n<t.sx;n++)for(var r=0;r<t.sy;r++)for(var a=0;a<t.depth;a++){for(var o=t.get(n,r,a),h=0,u=Math.max(0,a-s);u<=Math.min(a+s,t.depth-1);u++){var l=t.get(n,r,u);h+=l*l}h*=this.alpha/this.n,h+=this.k,this.S_cache_.set(n,r,a,h),h=Math.pow(h,this.beta),i.set(n,r,a,o/h)}return this.out_act=i,this.out_act},backward:function(){var e=this.in_act;e.dw=t.zeros(e.w.length);this.out_act;for(var i=Math.floor(this.n/2),s=0;s<e.sx;s++)for(var n=0;n<e.sy;n++)for(var r=0;r<e.depth;r++)for(var a=this.out_act.get_grad(s,n,r),o=this.S_cache_.get(s,n,r),h=Math.pow(o,this.beta),u=h*h,l=Math.max(0,r-i);l<=Math.min(r+i,e.depth-1);l++){var d=e.get(s,n,l),c=-d*this.beta*Math.pow(o,this.beta-1)*this.alpha/this.n*2*d;l===r&&(c+=h),c/=u,c*=a,e.add_grad(s,n,l,c)}},getParamsAndGrads:function(){return[]},toJSON:function(){var t={};return t.k=this.k,t.n=this.n,t.alpha=this.alpha,t.beta=this.beta,t.out_sx=this.out_sx,t.out_sy=this.out_sy,t.out_depth=this.out_depth,t.layer_type=this.layer_type,t},fromJSON:function(t){this.k=t.k,this.n=t.n,this.alpha=t.alpha,this.beta=t.beta,this.out_sx=t.out_sx,this.out_sy=t.out_sy,this.out_depth=t.out_depth,this.layer_type=t.layer_type}},t.LocalResponseNormalizationLayer=e}(n),function(t){t.Vol;var e=t.assert,i=function(t){this.layers=[]};i.prototype={makeLayers:function(i){e(i.length>=2,"Error! At least one input layer and one loss layer are required."),e("input"===i[0].type,"Error! First layer must be the input layer, to declare size of inputs");i=function(){for(var t=[],e=0;e<i.length;e++){var s=i[e];if("softmax"!==s.type&&"svm"!==s.type||t.push({type:"fc",num_neurons:s.num_classes}),"regression"===s.type&&t.push({type:"fc",num_neurons:s.num_neurons}),"fc"!==s.type&&"conv"!==s.type||"undefined"!==typeof s.bias_pref||(s.bias_pref=0,"undefined"!==typeof s.activation&&"relu"===s.activation&&(s.bias_pref=.1)),t.push(s),"undefined"!==typeof s.activation)if("relu"===s.activation)t.push({type:"relu"});else if("sigmoid"===s.activation)t.push({type:"sigmoid"});else if("tanh"===s.activation)t.push({type:"tanh"});else if("maxout"===s.activation){var n="undefined"!==s.group_size?s.group_size:2;t.push({type:"maxout",group_size:n})}else console.log("ERROR unsupported activation "+s.activation);"undefined"!==typeof s.drop_prob&&"dropout"!==s.type&&t.push({type:"dropout",drop_prob:s.drop_prob})}return t}(),this.layers=[];for(var s=0;s<i.length;s++){var n=i[s];if(s>0){var r=this.layers[s-1];n.in_sx=r.out_sx,n.in_sy=r.out_sy,n.in_depth=r.out_depth}switch(n.type){case"fc":this.layers.push(new t.FullyConnLayer(n));break;case"lrn":this.layers.push(new t.LocalResponseNormalizationLayer(n));break;case"dropout":this.layers.push(new t.DropoutLayer(n));break;case"input":this.layers.push(new t.InputLayer(n));break;case"softmax":this.layers.push(new t.SoftmaxLayer(n));break;case"regression":this.layers.push(new t.RegressionLayer(n));break;case"conv":this.layers.push(new t.ConvLayer(n));break;case"pool":this.layers.push(new t.PoolLayer(n));break;case"relu":this.layers.push(new t.ReluLayer(n));break;case"sigmoid":this.layers.push(new t.SigmoidLayer(n));break;case"tanh":this.layers.push(new t.TanhLayer(n));break;case"maxout":this.layers.push(new t.MaxoutLayer(n));break;case"svm":this.layers.push(new t.SVMLayer(n));break;default:console.log("ERROR: UNRECOGNIZED LAYER TYPE: "+n.type)}}},forward:function(t,e){"undefined"===typeof e&&(e=!1);for(var i=this.layers[0].forward(t,e),s=1;s<this.layers.length;s++)i=this.layers[s].forward(i,e);return i},getCostLoss:function(t,e){this.forward(t,!1);var i=this.layers.length;return this.layers[i-1].backward(e)},backward:function(t){for(var e=this.layers.length,i=this.layers[e-1].backward(t),s=e-2;s>=0;s--)this.layers[s].backward();return i},getParamsAndGrads:function(){for(var t=[],e=0;e<this.layers.length;e++)for(var i=this.layers[e].getParamsAndGrads(),s=0;s<i.length;s++)t.push(i[s]);return t},getPrediction:function(){var t=this.layers[this.layers.length-1];e("softmax"===t.layer_type,"getPrediction function assumes softmax as last layer of the net!");for(var i=t.out_act.w,s=i[0],n=0,r=1;r<i.length;r++)i[r]>s&&(s=i[r],n=r);return n},toJSON:function(){for(var t={layers:[]},e=0;e<this.layers.length;e++)t.layers.push(this.layers[e].toJSON());return t},fromJSON:function(e){this.layers=[];for(var i=0;i<e.layers.length;i++){var s,n=e.layers[i],r=n.layer_type;"input"===r&&(s=new t.InputLayer),"relu"===r&&(s=new t.ReluLayer),"sigmoid"===r&&(s=new t.SigmoidLayer),"tanh"===r&&(s=new t.TanhLayer),"dropout"===r&&(s=new t.DropoutLayer),"conv"===r&&(s=new t.ConvLayer),"pool"===r&&(s=new t.PoolLayer),"lrn"===r&&(s=new t.LocalResponseNormalizationLayer),"softmax"===r&&(s=new t.SoftmaxLayer),"regression"===r&&(s=new t.RegressionLayer),"fc"===r&&(s=new t.FullyConnLayer),"maxout"===r&&(s=new t.MaxoutLayer),"svm"===r&&(s=new t.SVMLayer),s.fromJSON(n),this.layers.push(s)}}},t.Net=i}(n),function(t){t.Vol;var e=function(t,e){this.net=t;e=e||{};this.learning_rate="undefined"!==typeof e.learning_rate?e.learning_rate:.01,this.l1_decay="undefined"!==typeof e.l1_decay?e.l1_decay:0,this.l2_decay="undefined"!==typeof e.l2_decay?e.l2_decay:0,this.batch_size="undefined"!==typeof e.batch_size?e.batch_size:1,this.method="undefined"!==typeof e.method?e.method:"sgd",this.momentum="undefined"!==typeof e.momentum?e.momentum:.9,this.ro="undefined"!==typeof e.ro?e.ro:.95,this.eps="undefined"!==typeof e.eps?e.eps:1e-6,this.k=0,this.gsum=[],this.xsum=[]};e.prototype={train:function(e,i){var s=(new Date).getTime();this.net.forward(e,!0);var n=(new Date).getTime()-s,r=(s=(new Date).getTime(),this.net.backward(i)),a=0,o=0,h=(new Date).getTime()-s;if(this.k++,this.k%this.batch_size===0){var u=this.net.getParamsAndGrads();if(0===this.gsum.length&&("sgd"!==this.method||this.momentum>0))for(var l=0;l<u.length;l++)this.gsum.push(t.zeros(u[l].params.length)),"adadelta"===this.method?this.xsum.push(t.zeros(u[l].params.length)):this.xsum.push([]);for(l=0;l<u.length;l++)for(var d=u[l],c=d.params,f=d.grads,_="undefined"!==typeof d.l2_decay_mul?d.l2_decay_mul:1,p="undefined"!==typeof d.l1_decay_mul?d.l1_decay_mul:1,y=this.l2_decay*_,v=this.l1_decay*p,m=c.length,x=0;x<m;x++){a+=y*c[x]*c[x]/2,o+=v*Math.abs(c[x]);var w=v*(c[x]>0?1:-1),g=(y*c[x]+w+f[x])/this.batch_size,b=this.gsum[l],O=this.xsum[l];if("adagrad"===this.method){b[x]=b[x]+g*g;var k=-this.learning_rate/Math.sqrt(b[x]+this.eps)*g;c[x]+=k}else if("windowgrad"===this.method){b[x]=this.ro*b[x]+(1-this.ro)*g*g;k=-this.learning_rate/Math.sqrt(b[x]+this.eps)*g;c[x]+=k}else if("adadelta"===this.method){b[x]=this.ro*b[x]+(1-this.ro)*g*g;k=-Math.sqrt((O[x]+this.eps)/(b[x]+this.eps))*g;O[x]=this.ro*O[x]+(1-this.ro)*k*k,c[x]+=k}else if("nesterov"===this.method){k=b[x];b[x]=b[x]*this.momentum+this.learning_rate*g,k=this.momentum*k-(1+this.momentum)*b[x],c[x]+=k}else if(this.momentum>0){k=this.momentum*b[x]-this.learning_rate*g;b[x]=k,c[x]+=k}else c[x]+=-this.learning_rate*g;f[x]=0}}return{fwd_time:n,bwd_time:h,l2_decay_loss:a,l1_decay_loss:o,cost_loss:r,softmax_loss:r,loss:r+o+a}}},t.Trainer=e,t.SGDTrainer=e}(n),function(t){var e=t.randf,i=t.randi,s=t.Net,n=t.Trainer,r=t.maxmin,a=t.randperm,o=t.weightedSample,h=t.getopt,u=t.arrUnique,l=function(t,e,i){i=i||{};"undefined"===typeof t&&(t=[]),"undefined"===typeof e&&(e=[]),this.data=t,this.labels=e,this.train_ratio=h(i,"train_ratio",.7),this.num_folds=h(i,"num_folds",10),this.num_candidates=h(i,"num_candidates",50),this.num_epochs=h(i,"num_epochs",50),this.ensemble_size=h(i,"ensemble_size",10),this.batch_size_min=h(i,"batch_size_min",10),this.batch_size_max=h(i,"batch_size_max",300),this.l2_decay_min=h(i,"l2_decay_min",-4),this.l2_decay_max=h(i,"l2_decay_max",2),this.learning_rate_min=h(i,"learning_rate_min",-4),this.learning_rate_max=h(i,"learning_rate_max",0),this.momentum_min=h(i,"momentum_min",.9),this.momentum_max=h(i,"momentum_max",.9),this.neurons_min=h(i,"neurons_min",5),this.neurons_max=h(i,"neurons_max",30),this.folds=[],this.candidates=[],this.evaluated_candidates=[],this.unique_labels=u(e),this.iter=0,this.foldix=0,this.finish_fold_callback=null,this.finish_batch_callback=null,this.data.length>0&&(this.sampleFolds(),this.sampleCandidates())};l.prototype={sampleFolds:function(){var t=this.data.length,e=Math.floor(this.train_ratio*t);this.folds=[];for(var i=0;i<this.num_folds;i++){var s=a(t);this.folds.push({train_ix:s.slice(0,e),test_ix:s.slice(e,t)})}},sampleCandidate:function(){var t=this.data[0].w.length,r=this.unique_labels.length,a=[];a.push({type:"input",out_sx:1,out_sy:1,out_depth:t});for(var h=o([0,1,2,3],[.2,.3,.3,.2]),u=0;u<h;u++){var l=i(this.neurons_min,this.neurons_max),d=["tanh","maxout","relu"][i(0,3)];if(e(0,1)<.5){var c=Math.random();a.push({type:"fc",num_neurons:l,activation:d,drop_prob:c})}else a.push({type:"fc",num_neurons:l,activation:d})}a.push({type:"softmax",num_classes:r});var f=new s;f.makeLayers(a);var _,p=i(this.batch_size_min,this.batch_size_max),y=Math.pow(10,e(this.l2_decay_min,this.l2_decay_max)),v=Math.pow(10,e(this.learning_rate_min,this.learning_rate_max)),m=e(this.momentum_min,this.momentum_max),x=e(0,1),w=new n(f,_=x<.33?{method:"adadelta",batch_size:p,l2_decay:y}:x<.66?{method:"adagrad",learning_rate:v,batch_size:p,l2_decay:y}:{method:"sgd",learning_rate:v,momentum:m,batch_size:p,l2_decay:y}),g={acc:[],accv:0};return g.layer_defs=a,g.trainer_def=_,g.net=f,g.trainer=w,g},sampleCandidates:function(){this.candidates=[];for(var t=0;t<this.num_candidates;t++){var e=this.sampleCandidate();this.candidates.push(e)}},step:function(){this.iter++;for(var t=this.folds[this.foldix],e=t.train_ix[i(0,t.train_ix.length)],r=0;r<this.candidates.length;r++){var a=this.data[e],o=this.labels[e];this.candidates[r].trainer.train(a,o)}var h=this.num_epochs*t.train_ix.length;if(this.iter>=h){var u=this.evalValErrors();for(r=0;r<this.candidates.length;r++){(l=this.candidates[r]).acc.push(u[r]),l.accv+=u[r]}if(this.iter=0,this.foldix++,null!==this.finish_fold_callback&&this.finish_fold_callback(),this.foldix>=this.folds.length){for(r=0;r<this.candidates.length;r++)this.evaluated_candidates.push(this.candidates[r]);this.evaluated_candidates.sort((function(t,e){return t.accv/t.acc.length>e.accv/e.acc.length?-1:1})),this.evaluated_candidates.length>3*this.ensemble_size&&(this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)),null!==this.finish_batch_callback&&this.finish_batch_callback(),this.sampleCandidates(),this.foldix=0}else for(r=0;r<this.candidates.length;r++){var l=this.candidates[r],d=new s;d.makeLayers(l.layer_defs);var c=new n(d,l.trainer_def);l.net=d,l.trainer=c}}},evalValErrors:function(){for(var t=[],e=this.folds[this.foldix],i=0;i<this.candidates.length;i++){for(var s=this.candidates[i].net,n=0,r=0;r<e.test_ix.length;r++){var a=this.data[e.test_ix[r]],o=this.labels[e.test_ix[r]];s.forward(a),n+=s.getPrediction()===o?1:0}n/=e.test_ix.length,t.push(n)}return t},predict_soft:function(t){var e,i,s=[],n=0;0===this.evaluated_candidates.length?(n=this.candidates.length,s=this.candidates):(n=Math.min(this.ensemble_size,this.evaluated_candidates.length),s=this.evaluated_candidates);for(var r=0;r<n;r++){var a=s[r].net.forward(t);if(0===r)e=a,i=a.w.length;else for(var o=0;o<i;o++)e.w[o]+=a.w[o]}for(o=0;o<i;o++)e.w[o]/=n;return e},predict:function(t){var e=this.predict_soft(t);if(0!==e.w.length)var i=r(e.w).maxi;else i=-1;return i},toJSON:function(){for(var t=Math.min(this.ensemble_size,this.evaluated_candidates.length),e={nets:[]},i=0;i<t;i++)e.nets.push(this.evaluated_candidates[i].net.toJSON());return e},fromJSON:function(t){this.ensemble_size=t.nets.length,this.evaluated_candidates=[];for(var e=0;e<this.ensemble_size;e++){var i=new s;i.fromJSON(t.nets[e]);var n={};n.net=i,this.evaluated_candidates.push(n)}},onFinishFold:function(t){this.finish_fold_callback=t},onFinishBatch:function(t){this.finish_batch_callback=t}},t.MagicNet=l}(n),s=n,"undefined"===typeof t.exports?window.jsfeat=s:t.exports=s}).call(this,i(28)(t))},,,,,,,,,,function(t,e,i){},,function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){},,function(t,e,i){},function(t,e,i){"use strict";i.r(e);var s=i(0),n=i.n(s),r=i(13),a=i.n(r),o=i(3),h=(i(22),i(1)),u=function(t){var e=t.children,i=t.onClick;return Object(h.jsx)("button",{className:"button",onClick:i,children:e})},l=i(2),d=i(32),c=i(9),f=n.a.createContext({containerWidth:0,tileCount:y}),_=function(t){var e=t.children,i=t.containerWidth,s=void 0===i?0:i,n=t.tileCount,r=void 0===n?y:n;return Object(h.jsx)(f.Provider,{value:{containerWidth:s,tileCount:r},children:e})},p=function(){var t=Object(s.useContext)(f);return[t.containerWidth,t.tileCount]},y=(i(24),4),v=i(10),m=(i(25),function(){var t=p(),e=Object(o.a)(t,2)[1];return Object(h.jsx)("div",{className:"grid",children:function(){for(var t=e*e,i=[],s=0;s<t;s+=1)i.push(Object(h.jsx)("div",{className:"grid-cell"},"".concat(s)));return i}()})}),x=i(14),w=(i(26),function(t){var e=t.value,i=t.position,n=t.zIndex,r=p(),a=Object(o.a)(r,2),u=a[0],l=a[1],d=Object(s.useState)(1),c=Object(o.a)(d,2),f=c[0],_=c[1],y=function(t){var e=Object(s.useRef)();return Object(s.useEffect)((function(){e.current=t})),e.current}(e),v=i[0]<l&&i[1]<l;Object(x.a)(v,"Tile out of bound");var m=void 0===y||y!==e;Object(s.useEffect)((function(){m&&(_(1.1),setTimeout((function(){return _(1)}),100))}),[m,f]);var w=function(t){return t/l*u},g={top:w(i[1]),left:w(i[0]),transform:"scale(".concat(f,")"),zIndex:n};return Object(h.jsx)("div",{className:"tile tile-".concat(e),style:g,children:e})}),g=(i(27),["id"]),b=function(t){var e=t.tiles,i=t.tileCountPerRow,s=void 0===i?y:i,n=116*s,r=n+16,a=e.map((function(t){var e=t.id,i=Object(v.a)(t,g);return Object(h.jsx)(w,Object(l.a)(Object(l.a)({},i),{},{zIndex:e}),"tile-".concat(e))}));return Object(h.jsx)("div",{className:"board",style:{width:r},children:Object(h.jsxs)(_,{containerWidth:n,tileCount:s,children:[Object(h.jsx)("div",{className:"tile-container",children:a}),Object(h.jsx)(m,{})]})})},O=1,k=i(17),j=i(7),M={tiles:{},byIds:[],hasChanged:!1,inMotion:!1},z=function(t,e){switch(e.type){case"CREATE_TILE":return Object(l.a)(Object(l.a)({},t),{},{tiles:Object(l.a)(Object(l.a)({},t.tiles),{},Object(j.a)({},e.tile.id,e.tile)),byIds:[].concat(Object(c.a)(t.byIds),[e.tile.id]),hasChanged:!1});case"UPDATE_TILE":return Object(l.a)(Object(l.a)({},t),{},{tiles:Object(l.a)(Object(l.a)({},t.tiles),{},Object(j.a)({},e.tile.id,e.tile)),hasChanged:!0});case"MERGE_TILE":var i=t.tiles,s=e.source.id,n=e.destination.id,r=(i[s],i[n],Object(v.a)(i,[s,n].map(k.a)));return Object(l.a)(Object(l.a)({},t),{},{tiles:Object(l.a)(Object(l.a)({},r),{},Object(j.a)({},e.destination.id,{id:e.destination.id,value:e.source.value+e.destination.value,position:e.destination.position})),byIds:t.byIds.filter((function(t){return t!==e.source.id})),hasChanged:!0});case"START_MOVE":return Object(l.a)(Object(l.a)({},t),{},{inMotion:!0});case"END_MOVE":return Object(l.a)(Object(l.a)({},t),{},{inMotion:!1});default:return t}},S=void 0,N=function(){var t=Object(s.useRef)(!0),e=[function(){return O++}],i=Object(o.a)(e,1)[0],n=Object(s.useReducer)(z,M),r=Object(o.a)(n,2),a=r[0],h=r[1],u=a.tiles,d=a.byIds,f=a.hasChanged,_=a.inMotion,p=Object(s.useCallback)((function(t){var e=t.position,s=t.value,n={id:i(),position:e,value:s};h({type:"CREATE_TILE",tile:n})}),[i]),v=function(t,e){setTimeout((function(){return function(t,e){h({type:"MERGE_TILE",source:t,destination:e})}(t,e)}),250)},m=function(t){h({type:"UPDATE_TILE",tile:t})},x=Object(s.useCallback)((function(){var t=new Array(y*y).fill(0);return d.forEach((function(e){var i=u[e].position,s=b(i);t[s]=e})),t}),[d,u]),w=Object(s.useCallback)((function(){return x().reduce((function(t,e,i){return 0===e?[].concat(Object(c.a)(t),[k(i)]):t}),[])}),[x]),g=Object(s.useCallback)((function(){var t=w();if(t.length>0){var e=t[Math.floor(Math.random()*t.length)];p({position:e,value:2})}}),[w,p]),b=function(t){return t[1]*y+t[0]},k=function(t){return[t%y,Math.floor(t/y)]},j=function(t,e){h({type:"START_MOVE"});for(var i=y-1,s=function(s){var n=t(s),r=void 0,a=0;n.forEach((function(t,n){var o=u[t];if(void 0!==r&&r.value===o.value){var h=Object(l.a)(Object(l.a)({},o),{},{position:r.position,mergeWith:r.id});return v(h,r),r=void 0,a+=1,m(h)}var d=Object(l.a)(Object(l.a)({},o),{},{position:k(e(s,n,a,i))});if(r=d,function(t,e){var i=t.position[0]!==e.position[0],s=t.position[1]!==e.position[1];return i||s}(o,d))return m(d)}))},n=0;n<y;n+=1)s(n);setTimeout((function(){return h({type:"END_MOVE"})}),250)};return Object(s.useEffect)((function(){if(t.current)return p({position:[0,1],value:2}),p({position:[0,2],value:2}),void(t.current=!1);!_&&f&&g()}),[f,_,p,g]),[d.map((function(t){return u[t]})),j.bind(S,(function(t){var e=x();return[e[t*y+0],e[t*y+1],e[t*y+2],e[t*y+3]].filter((function(t){return 0!==t}))}),(function(t,e,i,s){return t*y+e-i})),j.bind(S,(function(t){var e=x();return[e[t*y+0],e[t*y+1],e[t*y+2],e[t*y+3]].filter((function(t){return 0!==t})).reverse()}),(function(t,e,i,s){return t*y+s+i-e})),j.bind(S,(function(t){var e=x();return[e[t+0*y],e[t+1*y],e[t+2*y],e[t+3*y]].filter((function(t){return 0!==t}))}),(function(t,e,i,s){return t+y*(e-i)})),j.bind(S,(function(t){var e=x();return[e[t+0*y],e[t+1*y],e[t+2*y],e[t+3*y]].filter((function(t){return 0!==t})).reverse()}),(function(t,e,i,s){return t+y*(s-e+i)}))]},C=i(15),L=i(4),A=i(5),T=i(12),E=[];E.push({type:"input",out_sx:4,out_sy:4,out_depth:16});for(var J=[256,2400,1600,800,400,400,200,200,100,100,4],R=1;R<J.length-1;R++)E.push({type:"fc",num_neurons:J[R],activation:"relu"});E.push({type:"fc",num_neurons:4});var P=new T.a.Net;P.makeLayers(E);var I=new XMLHttpRequest;I.open("GET","https://lucetre.github.io/2048/NN/model.bin",!0),I.responseType="arraybuffer",I.onload=function(t){var e=I.response;if(e)for(var i=new Float32Array(e),s=0,n=1;n<J.length;n++){for(var r=2*n-1,a=0;a<J[n-1];a++)for(var o=0;o<J[n];o++)P.layers[r].filters[o].w[a]=i[s],s++;for(o=0;o<J[n];o++)P.layers[r].biases.w[o]=i[s],s++}},I.send(null);var V=function(){function t(e){Object(L.a)(this,t),this.grid=e,this.v=new T.a.Vol(4,4,16,0)}return Object(A.a)(t,[{key:"makeInput",value:function(){this.v.setConst(0);for(var t=0;t<4;t++)for(var e=0;e<4;e++)if(null!==this.grid.cells[e][t]){for(var i=0|this.grid.cells[e][t].value,s=0;i>2;)i>>=1,s+=1;this.v.w[4*t*16+16*e+s]=1}}},{key:"getBest",value:function(){this.makeInput();var t=P.forward(this.v).w,e=[0,1,2,3];return e.sort((function(e,i){return t[i]-t[e]})),{move:(e=e.map((function(t){return(t+3)%4})))[0],moves:e}}},{key:"translate",value:function(t){return{0:"Up \u2b06\ufe0f",1:"Right \u27a1\ufe0f",2:"Down \u2b07\ufe0f",3:"Left \u2b05\ufe0f"}[t]}}]),t}(),F=function(){function t(e,i){Object(L.a)(this,t),this.x=e.x,this.y=e.y,this.value=i||2,this.previousPosition=null,this.mergedFrom=null}return Object(A.a)(t,[{key:"savePosition",value:function(){this.previousPosition={x:this.x,y:this.y}}},{key:"updatePosition",value:function(t){this.x=t.x,this.y=t.y}},{key:"clone",value:function(){return new t({x:this.x,y:this.y},this.value)}}]),t}(),D=function(){function t(e){Object(L.a)(this,t),this.size=e,this.startTiles=2,this.cells=[],this.build(),this.playerTurn=!0}return Object(A.a)(t,[{key:"build",value:function(){for(var t=0;t<this.size;t++)for(var e=this.cells[t]=[],i=0;i<this.size;i++)e.push(null)}},{key:"randomAvailableCell",value:function(){var t=this.availableCells();if(t.length)return t[Math.floor(Math.random()*t.length)]}},{key:"availableCells",value:function(){var t=[];return this.eachCell((function(e,i,s){s||t.push({x:e,y:i})})),t}},{key:"eachCell",value:function(t){for(var e=0;e<this.size;e++)for(var i=0;i<this.size;i++)t(e,i,this.cells[e][i])}},{key:"cellsAvailable",value:function(){return!!this.availableCells().length}},{key:"cellAvailable",value:function(t){return!this.cellOccupied(t)}},{key:"cellOccupied",value:function(t){return!!this.cellContent(t)}},{key:"cellContent",value:function(t){return this.withinBounds(t)?this.cells[t.x][t.y]:null}},{key:"insertTile",value:function(t){this.cells[t.x][t.y]=t}},{key:"removeTile",value:function(t){this.cells[t.x][t.y]=null}},{key:"withinBounds",value:function(t){return t.x>=0&&t.x<this.size&&t.y>=0&&t.y<this.size}},{key:"clone",value:function(){var e=new t(this.size);e.playerTurn=this.playerTurn;for(var i=0;i<this.size;i++)for(var s=0;s<this.size;s++)this.cells[i][s]&&e.insertTile(this.cells[i][s].clone());return e}},{key:"addStartTiles",value:function(){for(var t=0;t<this.startTiles;t++)this.addRandomTile()}},{key:"addRandomTile",value:function(){if(this.cellsAvailable()){var t=Math.random()<.9?2:4,e=new F(this.randomAvailableCell(),t);this.insertTile(e)}}},{key:"prepareTiles",value:function(){this.eachCell((function(t,e,i){i&&(i.mergedFrom=null,i.savePosition())}))}},{key:"moveTile",value:function(t,e){this.cells[t.x][t.y]=null,this.cells[e.x][e.y]=t,t.updatePosition(e)}},{key:"getVector",value:function(t){return this.vectors[t]}},{key:"move",value:function(t){var e,i,s=this,n=this.getVector(t),r=this.buildTraversals(n),a=!1,o=0;return this.prepareTiles(),r.x.forEach((function(t){r.y.forEach((function(r){if(e=s.indexes[t][r],i=s.cellContent(e)){var h=s.findFarthestPosition(e,n),u=s.cellContent(h.next);if(u&&u.value===i.value&&!u.mergedFrom){var l=new F(h.next,2*i.value);l.mergedFrom=[i,u],s.insertTile(l),s.removeTile(i),i.updatePosition(h.next),o+=l.value,l.value}else s.moveTile(i,h.farthest);s.positionsEqual(e,i)||(s.playerTurn=!1,a=!0)}}))})),{moved:a,score:o,won:!1}}},{key:"computerMove",value:function(){this.addRandomTile(),this.playerTurn=!0}},{key:"buildTraversals",value:function(t){for(var e={x:[],y:[]},i=0;i<this.size;i++)e.x.push(i),e.y.push(i);return 1===t.x&&(e.x=e.x.reverse()),1===t.y&&(e.y=e.y.reverse()),e}},{key:"findFarthestPosition",value:function(t,e){var i;do{t={x:(i=t).x+e.x,y:i.y+e.y}}while(this.withinBounds(t)&&this.cellAvailable(t));return{farthest:i,next:t}}},{key:"movesAvailable",value:function(){return this.cellsAvailable()||this.tileMatchesAvailable()}},{key:"tileMatchesAvailable",value:function(){for(var t,e=0;e<this.size;e++)for(var i=0;i<this.size;i++)if(t=this.cellContent({x:e,y:i}))for(var s=0;s<4;s++){var n=this.getVector(s),r={x:e+n.x,y:i+n.y},a=this.cellContent(r);if(a&&a.value===t.value)return!0}return!1}},{key:"positionsEqual",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"toString",value:function(){for(var t="",e=0;e<4;e++){for(var i=0;i<4;i++)this.cells[i][e]?t+=this.cells[i][e].value+" ":t+="_ ";t+="\n"}return t}},{key:"islands",value:function(){for(var t=this,e=function e(i,s,n){if(i>=0&&i<=3&&s>=0&&s<=3&&t.cells[i][s]&&t.cells[i][s].value==n&&!t.cells[i][s].marked)for(var r in t.cells[i][s].marked=!0,[0,1,2,3]){var a=t.getVector(r);e(i+a.x,s+a.y,n)}},i=0,s=0;s<4;s++)for(var n=0;n<4;n++)this.cells[s][n]&&(this.cells[s][n].marked=!1);for(s=0;s<4;s++)for(n=0;n<4;n++)this.cells[s][n]&&!this.cells[s][n].marked&&(i++,e(s,n,this.cells[s][n].value));return i}},{key:"smoothness",value:function(){for(var t=0,e=0;e<4;e++)for(var i=0;i<4;i++)if(this.cellOccupied(this.indexes[e][i]))for(var s=Math.log(this.cellContent(this.indexes[e][i]).value)/Math.log(2),n=1;n<=2;n++){var r=this.getVector(n),a=this.findFarthestPosition(this.indexes[e][i],r).next;if(this.cellOccupied(a)){var o=this.cellContent(a),h=Math.log(o.value)/Math.log(2);t-=Math.abs(s-h)}}return t}},{key:"monotonicity",value:function(){for(var t=this,e=[],i=[],s=0,n={x:0,y:0},r=0;r<4;r++){e.push([]),i.push([]);for(var a=0;a<4;a++)e[r].push(!1),i[r].push(!1),this.cells[r][a]&&this.cells[r][a].value>s&&(s=this.cells[r][a].value,n.x=r,n.y=a)}var o=0,h=[n];i[n.x][n.y]=!0;for(var u=[n],l=1,d=function(s){var n;for(var r in u.push(s),n=t.cellOccupied(s)?Math.log(t.cellContent(s).value)/Math.log(2):0,[0,1,2,3]){var a=t.getVector(r),d={x:s.x+a.x,y:s.y+a.y};if(t.withinBounds(d)&&!e[d.x][d.y]){if(t.cellOccupied(d)){var c=Math.log(t.cellContent(d).value)/Math.log(2);c>n&&(o+=c-n)}i[d.x][d.y]||(h.push(d),i[d.x][d.y]=!0)}}if(0==l){for(;u.length>0;){var f=u.pop();e[f.x][f.y]=!0}l=h.length}};h.length>0;)l--,d(h.shift());return-o}},{key:"monotonicity2",value:function(){for(var t=[0,0,0,0],e=0;e<4;e++)for(var i=(n=0)+1;i<4;){for(;i<4&&!this.cellOccupied(this.indexes[e][i]);)i++;i>=4&&i--,(r=this.cellOccupied({x:e,y:n})?Math.log(this.cellContent(this.indexes[e][n]).value)/Math.log(2):0)>(a=this.cellOccupied({x:e,y:i})?Math.log(this.cellContent(this.indexes[e][i]).value)/Math.log(2):0)?t[0]+=a-r:a>r&&(t[1]+=r-a),n=i,i++}for(var s=0;s<4;s++){var n;for(i=(n=0)+1;i<4;){for(;i<4&&!this.cellOccupied(this.indexes[i][s]);)i++;var r,a;i>=4&&i--,(r=this.cellOccupied({x:n,y:s})?Math.log(this.cellContent(this.indexes[n][s]).value)/Math.log(2):0)>(a=this.cellOccupied({x:i,y:s})?Math.log(this.cellContent(this.indexes[i][s]).value)/Math.log(2):0)?t[2]+=a-r:a>r&&(t[3]+=r-a),n=i,i++}}return Math.max(t[0],t[1])+Math.max(t[2],t[3])}},{key:"maxValue",value:function(){for(var t=0,e=0;e<4;e++)for(var i=0;i<4;i++)if(this.cellOccupied(this.indexes[e][i])){var s=this.cellContent(this.indexes[e][i]).value;s>t&&(t=s)}return Math.log(t)/Math.log(2)}},{key:"isWin",value:function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++)if(this.cellOccupied(this.indexes[t][e])&&2048==this.cellContent(this.indexes[t][e]).value)return!0;return!1}}]),t}();D.prototype.indexes=[];for(var G=0;G<4;G++){D.prototype.indexes.push([]);for(var q=0;q<4;q++)D.prototype.indexes[G].push({x:G,y:q})}D.prototype.vectors={0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}};var B=function(){function t(e){Object(L.a)(this,t),this.grid=this.encode(e),this.ai=new V(this.grid)}return Object(A.a)(t,[{key:"think",value:function(){this.decode(this.grid);var t=this.ai.getBest();return this.ai.translate(t.move)}},{key:"move",value:function(t){this.grid.move(t)}},{key:"decode",value:function(t){var e=t.cells.map((function(t){return t.map((function(t){return t?t.value:0}))}));e=e[0].map((function(t,i){return e.map((function(t){return t[i]}))}))}},{key:"encode",value:function(t){var e,i=new D(4),s=Object(C.a)(t);try{for(s.s();!(e=s.n()).done;){var n=e.value,r=n.position,a=n.value,h=Object(o.a)(r,2),u=h[0],l=h[1];i.cells[u][l]=new F({x:u,y:l},a)}}catch(d){s.e(d)}finally{s.f()}return i}}]),t}(),U=i(16),W=function(t){var e=t.think,i=t.setThink,n=t.hintAct,r=t.setHintAct,a=N(),u=Object(o.a)(a,5),c=u[0],f=u[1],_=u[2],p=u[3],v=u[4],m=Object(s.useState)(0),x=Object(o.a)(m,2),w=x[0],g=x[1],O=Object(s.useState)(!1),k=Object(o.a)(O,2),j=k[0],M=k[1];Object(s.useEffect)((function(){if(n){switch(e){case"Up \u2b06\ufe0f":p();break;case"Right \u27a1\ufe0f":_();break;case"Down \u2b07\ufe0f":v();break;case"Left \u2b05\ufe0f":f()}r(!1)}}),[n,r,e,p,_,v,f]),Object(s.useEffect)((function(){if(i&&(M(!0),g(c.length-1)),j){if(c.length===w+1){var t=new B(c).think();i(t)}g(c.length)}}),[c,i,w,j]);var z=Object(U.a)({onSwipedLeft:f,onSwipedRight:_,onSwipedUp:p,onSwipedDown:v,preventScrollOnSwipe:!0,trackMouse:!0}),S=Object(d.a)((function(t){switch(t.preventDefault(),t.code){case"ArrowLeft":f();break;case"ArrowRight":_();break;case"ArrowUp":p();break;case"ArrowDown":v()}}),250,{leading:!0,trailing:!1});return Object(s.useEffect)((function(){return window.addEventListener("keydown",S),function(){window.removeEventListener("keydown",S)}}),[S]),Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("div",Object(l.a)({className:"touch-area"},z)),Object(h.jsx)(b,{tiles:c,tileCountPerRow:y})]})},Z=(i(29),function(){var t=Object(s.useState)(new Date),e=Object(o.a)(t,2),i=e[0],n=e[1],r=Object(s.useState)("Think"),a=Object(o.a)(r,2),l=a[0],d=a[1],c=Object(s.useState)(!1),f=Object(o.a)(c,2),_=f[0],p=f[1];return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsxs)("div",{className:"header",children:[Object(h.jsx)("div",{children:Object(h.jsx)("h1",{children:"Play 2048"})}),Object(h.jsx)("div",{className:"button-area",children:Object(h.jsx)(u,{onClick:"Think"===l?function(){alert("Let me give you some hints!"),d("")}:function(){p(!0)},children:l})}),Object(h.jsx)("div",{className:"button-area",children:Object(h.jsx)(u,{onClick:function(){n(new Date),d("Think"),p(!1)},children:"Reset"})})]}),Object(h.jsx)(W,{think:l,setThink:"Think"===l?null:d,hintAct:_,setHintAct:p},i.toISOString())]})}),H=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,33)).then((function(e){var i=e.getCLS,s=e.getFID,n=e.getFCP,r=e.getLCP,a=e.getTTFB;i(t),s(t),n(t),r(t),a(t)}))};a.a.render(Object(h.jsx)(n.a.StrictMode,{children:Object(h.jsx)(Z,{})}),document.getElementById("root")),H()}],[[30,1,2]]]);
//# sourceMappingURL=main.83516481.chunk.js.map